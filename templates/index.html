<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Secure File Sharing</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { 
            background-color: #fdfdfd;
            color: #333;
            font-family: 'Segoe UI', sans-serif;
        }
        .container { 
            margin-top: 50px; 
            max-width: 900px; 
            background-color: #ffffff;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        h1, h2 { 
            text-align: center; 
            color: #1a1a1a;
        }
        .file-card { 
            padding: 15px; 
            margin-bottom: 15px; 
            border-radius: 10px; 
            background: #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.25s, box-shadow 0.25s;
        }
        .file-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }
        .upload-btn { 
            width: 100%;
            background: #6c63ff;
            border: none;
            font-weight: bold;
            color: #fff;
            transition: all 0.3s;
        }
        .upload-btn:hover {
            background: #574fd6;
            transform: translateY(-2px);
        }
        .timestamp {
            font-size: 0.85rem;
            color: #777;
        }
        .btn-download {
            background: #20c997;
            border: none;
            color: #fff;
            font-weight: bold;
        }
        .btn-download:hover {
            background: #17a589;
        }
        .btn-delete {
            background: #ff6b6b;
            border: none;
            color: #fff;
            font-weight: bold;
        }
        .btn-delete:hover {
            background: #e74c3c;
        }
        .flash-message {
            border-radius: 10px;
            background-color: #f1f3f5;
            color: #333;
        }
        input[type="file"] {
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">üîê Secure File Sharing</h1>

        <!-- Flash messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} flash-message alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Upload Form -->
        <div class="card mb-5 p-4" style="background: #f8f9fa;">
            <form method="POST" enctype="multipart/form-data">
                <div class="mb-3">
                    <label for="file" class="form-label">Select a file to upload</label>
                    <input class="form-control" type="file" id="file" name="file" required>
                </div>
                <button type="submit" class="btn upload-btn">
                    <i class="bi bi-cloud-upload"></i> Upload File
                </button>
            </form>
        </div>

        <!-- Uploaded Files -->
        <h2 class="mb-3">Uploaded Files</h2>
        {% if files %}
            {% for file in files %}
                <div class="file-card">
                    <div>
                        <strong>{{ file.original_filename }}</strong><br>
                        <span class="timestamp">{{ file.timestamp|datetimeformat }}</span>
                    </div>
                    <div class="d-flex">
                        <a href="{{ url_for('download', stored_filename=file.stored_name) }}" class="btn btn-download btn-sm me-2">
                            <i class="bi bi-download"></i> Download
                        </a>
                        <button class="btn btn-delete btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal" data-filename="{{ file.stored_name }}">
                            <i class="bi bi-trash"></i> Delete
                        </button>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p class="text-center text-muted">No files uploaded yet.</p>
        {% endif %}
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <form id="deleteForm" method="POST">
              <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                Are you sure you want to delete this file? This action cannot be undone.
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-delete">Delete</button>
              </div>
          </form>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        var deleteModal = document.getElementById('deleteModal')
        deleteModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget
            var filename = button.getAttribute('data-filename')
            var form = document.getElementById('deleteForm')
            form.action = '/delete/' + filename
        })
    </script>
</body>
</html>
